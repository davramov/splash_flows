# Beamline 7.3.3


## Flow Diagram
```mermaid
sequenceDiagram
    participant DET as Detector/<br/>File Watcher
    participant DISP as Prefect<br/>Dispatcher
    participant D733 as data733<br/>Storage
    participant GLOB as Globus<br/>Transfer
    participant CFS as NERSC<br/>CFS
    participant CAT as SciCat<br/>Metadata
    participant SFAPI as SFAPI
    participant HPC as HPC<br/>Compute
    participant HPSS as HPSS<br/>Tape
    
    %% Initial Trigger
    DET->>DET: Monitor filesystem
    DET->>DISP: Trigger on new file
    DISP->>DISP: Coordinate flows
    
    %% Flow 1: new_file_733
    rect rgb(220, 230, 255)
        note over DISP,CAT: FLOW 1: new_file_733
        DISP->>GLOB: Init transfer
        activate GLOB
        GLOB->>D733: Initiate copy
        activate D733
        D733-->>GLOB: Copy initiated
        deactivate D733
        %% note right of GLOB: Transfer in progress
        GLOB-->>DISP: Transfer complete
        deactivate GLOB
        
        DISP->>CAT: Register metadata
    end
    
    %% Flow 2: HPSS Transfer
    rect rgb(220, 255, 230)
        note over DISP,CAT: FLOW 2: Scheduled HPSS Transfer
        DISP->>SFAPI: Submit tape job
        activate SFAPI
        SFAPI->>HPSS: Initiate archive
        activate HPSS
        HPSS-->>SFAPI: Archive complete
        deactivate HPSS
        SFAPI-->>DISP: Job complete
        deactivate SFAPI
        
        DISP->>CAT: Update metadata
    end
    
    %% Flow 3: HPC Analysis
    rect rgb(255, 230, 230)
        note over DISP,HPC: FLOW 3: HPC Downstream Analysis
        DISP->>SFAPI: Submit compute job
        activate SFAPI
        SFAPI->>HPC: Execute job
        activate HPC
        HPC->>HPC: Process data
        HPC-->>SFAPI: Compute complete
        deactivate HPC
        SFAPI-->>DISP: Job complete
        deactivate SFAPI
        
        DISP->>CAT: Update metadata
    end
    
    %% Flow 4: Scheduled Pruning
    rect rgb(255, 255, 220)
        note over DISP,CAT: FLOW 4: Scheduled Pruning
        DISP->>DISP: Scheduled pruning trigger
        
        DISP->>D733: Prune old files
        activate D733
        D733->>D733: Delete expired data
        D733-->>DISP: Pruning complete
        deactivate D733
        
        DISP->>CFS: Prune old files
        activate CFS
        CFS->>CFS: Delete expired data
        CFS-->>DISP: Pruning complete
        deactivate CFS
        
        DISP->>CAT: Update metadata
    end
  ```